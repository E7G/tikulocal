name: æž„å»ºé¢˜åº“ç®¡ç†ç³»ç»Ÿ (ç®€åŒ–ç‰ˆ)

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'ç‰ˆæœ¬å·'
        required: true
        default: 'v1.2.6'
      platform:
        description: 'ç›®æ ‡å¹³å°'
        required: true
        default: 'windows'
        type: choice
        options:
        - windows
        - linux
        - macos

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®GoçŽ¯å¢ƒ
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
        
    - name: å®‰è£…fyneå·¥å…·
      run: go install fyne.io/tools/cmd/fyne@latest
        
    - name: ä¸‹è½½ä¾èµ–
      run: go mod download
      
    - name: æž„å»ºåº”ç”¨
      run: |
        # è®¾ç½®ç›®æ ‡å¹³å°
        export GOOS=${{ github.event.inputs.platform }}
        export GOARCH=amd64
        
        echo "æž„å»ºå¹³å°: $GOOS-$GOARCH"
        
        # æž„å»ºå¯æ‰§è¡Œæ–‡ä»¶
        go build -ldflags="-s -w" -o tikulocal .
        
        # ä½¿ç”¨fyneæ‰“åŒ…
        if [ "$GOOS" = "windows" ]; then
          fyne package -os windows -icon icon.png -name "é¢˜åº“ç®¡ç†ç³»ç»Ÿ"
        elif [ "$GOOS" = "linux" ]; then
          fyne package -os linux -icon icon.png -name "é¢˜åº“ç®¡ç†ç³»ç»Ÿ"
        elif [ "$GOOS" = "macos" ]; then
          fyne package -os darwin -icon icon.png -name "é¢˜åº“ç®¡ç†ç³»ç»Ÿ"
        fi
        
    - name: ä¸Šä¼ æž„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: tikulocal-${{ github.event.inputs.platform }}-${{ github.event.inputs.version }}
        path: |
          tikulocal*
          *.exe
          *.app
          *.tar.gz
        retention-days: 30
        
    - name: æ˜¾ç¤ºæž„å»ºä¿¡æ¯
      run: |
        echo "âœ… æž„å»ºå®Œæˆ!"
        echo "ðŸ“¦ ç‰ˆæœ¬: ${{ github.event.inputs.version }}"
        echo "ðŸ–¥ï¸ å¹³å°: ${{ github.event.inputs.platform }}"
        echo "ðŸ“ æž„å»ºäº§ç‰©:"
        ls -la tikulocal* *.exe *.app *.tar.gz 2>/dev/null || echo "æœªæ‰¾åˆ°æž„å»ºäº§ç‰©" 