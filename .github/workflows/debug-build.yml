name: è°ƒè¯•æ„å»º

on:
  workflow_dispatch:
    inputs:
      platform:
        description: 'ç›®æ ‡å¹³å°'
        required: true
        default: 'windows'
        type: choice
        options:
        - windows
        - linux
        - macos

jobs:
  debug-build:
    runs-on: windows-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®Goç¯å¢ƒ
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
        
    - name: æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
      shell: bash
      run: |
        echo "ğŸ” ç¯å¢ƒä¿¡æ¯:"
        echo "GOOS: $GOOS"
        echo "GOARCH: $GOARCH"
        echo "GOROOT: $GOROOT"
        echo "GOPATH: $GOPATH"
        echo "å½“å‰ç›®å½•: $(pwd)"
        echo "ç›®å½•å†…å®¹:"
        ls -la
        
    - name: ä¸‹è½½ä¾èµ–
      run: go mod download
      
    - name: éªŒè¯ä¾èµ–
      run: go mod verify
      
    - name: æµ‹è¯•æ„å»º
      shell: bash
      run: |
        # è®¾ç½®ç›®æ ‡å¹³å°
        export GOOS=${{ github.event.inputs.platform }}
        export GOARCH=amd64
        
        echo "ğŸ”¨ å¼€å§‹æµ‹è¯•æ„å»º..."
        echo "ğŸ“‹ æ„å»ºå‚æ•°: GOOS=$GOOS, GOARCH=$GOARCH"
        
        # å°è¯•æ„å»º
        echo "ğŸ“ æ‰§è¡Œ: go build -ldflags='-s -w' -o tikulocal ."
        go build -ldflags="-s -w" -o tikulocal .
        
        echo "ğŸ“ æ„å»ºåçš„æ–‡ä»¶åˆ—è¡¨:"
        ls -la
        
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if [ "$GOOS" = "windows" ]; then
          if [ -f "tikulocal.exe" ]; then
            echo "âœ… tikulocal.exe å­˜åœ¨"
            file tikulocal.exe
          else
            echo "âŒ tikulocal.exe ä¸å­˜åœ¨"
          fi
        else
          if [ -f "tikulocal" ]; then
            echo "âœ… tikulocal å­˜åœ¨"
            file tikulocal
          else
            echo "âŒ tikulocal ä¸å­˜åœ¨"
          fi
        fi
        
    - name: æµ‹è¯•fyneå·¥å…·
      shell: bash
      run: |
        echo "ğŸ”§ æ£€æŸ¥fyneå·¥å…·..."
        which fyne || echo "fyneå·¥å…·æœªå®‰è£…"
        
        # å®‰è£…fyneå·¥å…·
        echo "ğŸ“¦ å®‰è£…fyneå·¥å…·..."
        go install fyne.io/tools/cmd/fyne@latest
        
        echo "ğŸ”§ æ£€æŸ¥fyneå·¥å…·å®‰è£…..."
        which fyne || echo "fyneå·¥å…·å®‰è£…å¤±è´¥"
        fyne version || echo "æ— æ³•è·å–fyneç‰ˆæœ¬"
        
    - name: æµ‹è¯•fyneæ‰“åŒ…
      shell: bash
      run: |
        # è®¾ç½®ç›®æ ‡å¹³å°
        export GOOS=${{ github.event.inputs.platform }}
        export GOARCH=amd64
        
        echo "ğŸ“¦ å¼€å§‹æµ‹è¯•fyneæ‰“åŒ…..."
        echo "ğŸ“‹ æ‰“åŒ…å‚æ•°: GOOS=$GOOS, GOARCH=$GOARCH"
        
        # æ£€æŸ¥å›¾æ ‡æ–‡ä»¶
        if [ -f "icon.png" ]; then
          echo "âœ… icon.png å­˜åœ¨"
        else
          echo "âŒ icon.png ä¸å­˜åœ¨"
        fi
        
        # å°è¯•fyneæ‰“åŒ…
        if [ "$GOOS" = "windows" ]; then
          echo "ğŸ“ æ‰§è¡Œ: fyne package -os windows -icon icon.png -name 'é¢˜åº“ç®¡ç†ç³»ç»Ÿ'"
          fyne package -os windows -icon icon.png -name "é¢˜åº“ç®¡ç†ç³»ç»Ÿ"
        elif [ "$GOOS" = "linux" ]; then
          echo "ğŸ“ æ‰§è¡Œ: fyne package -os linux -icon icon.png -name 'é¢˜åº“ç®¡ç†ç³»ç»Ÿ'"
          fyne package -os linux -icon icon.png -name "é¢˜åº“ç®¡ç†ç³»ç»Ÿ"
        elif [ "$GOOS" = "macos" ]; then
          echo "ğŸ“ æ‰§è¡Œ: fyne package -os darwin -icon icon.png -name 'é¢˜åº“ç®¡ç†ç³»ç»Ÿ'"
          fyne package -os darwin -icon icon.png -name "é¢˜åº“ç®¡ç†ç³»ç»Ÿ"
        fi
        
        echo "ğŸ“ fyneæ‰“åŒ…åçš„æ–‡ä»¶åˆ—è¡¨:"
        ls -la
        
    - name: æ˜¾ç¤ºæœ€ç»ˆç»“æœ
      shell: bash
      run: |
        echo "ğŸ¯ æœ€ç»ˆæ„å»ºç»“æœ:"
        echo "ğŸ“ å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶:"
        ls -la
        
        echo "ğŸ“Š æ–‡ä»¶ç»Ÿè®¡:"
        echo "å¯æ‰§è¡Œæ–‡ä»¶:"
        find . -name "*.exe" -o -name "tikulocal" -o -name "*.app" -o -name "*.tar.gz" 2>/dev/null || echo "æœªæ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶"
        
        echo "ğŸ“‹ æ„å»ºæ€»ç»“:"
        if [ "${{ github.event.inputs.platform }}" = "windows" ]; then
          if [ -f "tikulocal.exe" ]; then
            echo "âœ… åŸå§‹æ„å»ºæ–‡ä»¶å­˜åœ¨"
          else
            echo "âŒ åŸå§‹æ„å»ºæ–‡ä»¶ä¸å­˜åœ¨"
          fi
          if [ -f "é¢˜åº“ç®¡ç†ç³»ç»Ÿ.exe" ]; then
            echo "âœ… fyneæ‰“åŒ…æ–‡ä»¶å­˜åœ¨"
          else
            echo "âŒ fyneæ‰“åŒ…æ–‡ä»¶ä¸å­˜åœ¨"
          fi
        fi 