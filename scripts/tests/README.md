# TikuLocal测试套件

这是TikuLocal题库管理系统的完整测试套件，提供全面的功能测试、性能测试和集成测试。

## 📋 测试覆盖范围

### 1. API集成测试 (`test_api_integration.py`)
- ✅ 首页访问测试
- ✅ 题目创建测试（单选、多选、判断、填空、问答）
- ✅ 题目搜索测试
- ✅ 适配器搜索测试
- ✅ 批量导入测试
- ✅ 获取所有题目测试
- ✅ 错误处理测试
- ✅ CORS测试
- ✅ 并发请求测试

### 2. 数据库操作测试 (`test_database_operations.py`)
- ✅ 表结构验证
- ✅ 索引存在性检查
- ✅ 数据插入测试
- ✅ 搜索性能测试
- ✅ 数据完整性验证
- ✅ 并发访问测试
- ✅ JSON数据验证
- ✅ 备份恢复测试

### 3. 文件解析测试 (`test_file_parsing.py`)
- ✅ 文本文件读取测试
- ✅ JSON文件读取测试
- ✅ Base64编码测试
- ✅ 题目类型检测
- ✅ 答案解析测试（单选、多选）
- ✅ 大文件处理测试
- ✅ 编码处理测试
- ✅ JSON模式验证
- ✅ 文件格式检测
- ✅ 数据验证

### 4. 性能测试 (`test_performance.py`)
- ✅ 首页响应时间测试
- ✅ 搜索性能测试
- ✅ 创建题目性能测试
- ✅ 并发请求性能测试
- ✅ 内存使用测试
- ✅ 批量导入性能测试
- ✅ 数据库查询性能测试
- ✅ 错误响应时间测试
- ✅ 压力测试

## 🚀 快速开始

### 前提条件
1. TikuLocal服务必须在 `http://localhost:8060` 运行
2. Python 3.6+ 环境
3. 安装测试依赖

### 安装依赖
```bash
cd tests
pip install -r requirements.txt
```

### 启动服务
```bash
# 在项目根目录
cargo run
```

### 运行所有测试
```bash
# 在项目根目录
python tests/run_all_tests.py
```

### 运行单个测试文件
```bash
cd tests
python test_api_integration.py
python test_database_operations.py
python test_file_parsing.py
python test_performance.py
```

## 📊 性能基准

### 响应时间要求
- 首页响应: < 0.5秒
- 题目搜索: < 1.0秒
- 题目创建: < 0.5秒
- 批量导入: 100题 < 5秒
- 错误响应: < 0.5秒

### 并发性能要求
- 10并发: 成功率 ≥ 80%
- 20并发: 成功率 ≥ 80%
- 50并发: 成功率 ≥ 80%

### 压力测试要求
- 30秒持续测试: 成功率 ≥ 70%
- 请求频率: ≥ 5请求/秒

## 🔧 测试环境配置

### 数据库配置
- 使用SQLite数据库 `questions.db`
- 自动创建必要的表和索引
- 测试完成后自动清理数据

### 测试数据
- 自动生成100个测试题目
- 覆盖所有题型（单选、多选、判断、填空、问答）
- 包含各种边界情况测试

## 📈 测试结果解读

### 成功指标
- ✅ 所有测试通过
- 📈 成功率 > 95%
- ⚡ 响应时间符合基准要求
- 🔒 无内存泄漏
- 🚀 并发处理能力强

### 失败处理
如果测试失败，请检查：
1. 服务是否正确启动
2. 网络连接是否正常
3. 端口配置是否正确
4. 依赖包是否安装
5. 系统资源是否充足

## 🛠️ 故障排除

### 常见问题

**服务未启动**
```bash
# 检查服务状态
curl http://localhost:8060/

# 启动服务
cargo run
```

**依赖缺失**
```bash
# 安装依赖
pip install requests psutil
```

**端口占用**
```bash
# 检查端口占用
netstat -ano | findstr :8060

# 或修改服务端口
# 编辑 src/main.rs 中的端口配置
```

**权限问题**
```bash
# Windows系统可能需要管理员权限运行
# 右键以管理员身份运行终端
```

## 📄 测试报告

测试完成后会生成详细报告：
- 控制台输出：实时测试结果
- JSON报告：`tests/test_report.json`
- 性能指标：响应时间、成功率等

## 🤝 贡献指南

添加新测试：
1. 创建新的测试文件
2. 遵循现有测试模式
3. 更新本README文档
4. 添加到 `run_all_tests.py`

## 📞 支持

如有问题，请检查：
- 服务日志输出
- 测试详细输出
- 系统资源使用情况
- 网络连接状态